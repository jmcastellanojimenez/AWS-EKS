# Custom Grafana Dashboards for EKS Learning Lab
apiVersion: v1
kind: ConfigMap
metadata:
  name: eks-learning-dashboards
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  eks-cluster-overview.json: |
    {
      "dashboard": {
        "id": null,
        "title": "EKS Learning Lab - Cluster Overview",
        "tags": ["kubernetes", "eks", "learning"],
        "style": "dark",
        "timezone": "browser",
        "panels": [
          {
            "id": 1,
            "title": "Cluster Nodes",
            "type": "stat",
            "targets": [
              {
                "expr": "count(kube_node_info)",
                "legendFormat": "Total Nodes"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 5},
                    {"color": "red", "value": 10}
                  ]
                }
              }
            },
            "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Running Pods",
            "type": "stat",
            "targets": [
              {
                "expr": "count(kube_pod_info{phase=\"Running\"})",
                "legendFormat": "Running Pods"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 50},
                    {"color": "red", "value": 100}
                  ]
                }
              }
            },
            "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0}
          },
          {
            "id": 3,
            "title": "CPU Usage by Node",
            "type": "graph",
            "targets": [
              {
                "expr": "100 - (avg by (instance) (irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
                "legendFormat": "{{instance}}"
              }
            ],
            "yAxes": [
              {
                "label": "Percent",
                "max": 100,
                "min": 0
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4}
          },
          {
            "id": 4,
            "title": "Memory Usage by Node",
            "type": "graph",
            "targets": [
              {
                "expr": "(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100",
                "legendFormat": "{{instance}}"
              }
            ],
            "yAxes": [
              {
                "label": "Percent",
                "max": 100,
                "min": 0
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4}
          },
          {
            "id": 5,
            "title": "Pod Count by Namespace",
            "type": "graph",
            "targets": [
              {
                "expr": "count by (namespace) (kube_pod_info)",
                "legendFormat": "{{namespace}}"
              }
            ],
            "gridPos": {"h": 8, "w": 24, "x": 0, "y": 12}
          },
          {
            "id": 6,
            "title": "Top CPU Consuming Pods",
            "type": "table",
            "targets": [
              {
                "expr": "topk(10, sum by (pod, namespace) (rate(container_cpu_usage_seconds_total{container!=\"POD\"}[5m])))",
                "format": "table",
                "instant": true
              }
            ],
            "transformations": [
              {
                "id": "organize",
                "options": {
                  "excludeByName": {
                    "Time": true,
                    "__name__": true
                  },
                  "indexByName": {},
                  "renameByName": {
                    "namespace": "Namespace",
                    "pod": "Pod",
                    "Value": "CPU Usage (cores)"
                  }
                }
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 20}
          },
          {
            "id": 7,
            "title": "Top Memory Consuming Pods",
            "type": "table",
            "targets": [
              {
                "expr": "topk(10, sum by (pod, namespace) (container_memory_working_set_bytes{container!=\"POD\"}))",
                "format": "table",
                "instant": true
              }
            ],
            "transformations": [
              {
                "id": "organize",
                "options": {
                  "excludeByName": {
                    "Time": true,
                    "__name__": true
                  },
                  "indexByName": {},
                  "renameByName": {
                    "namespace": "Namespace",
                    "pod": "Pod",
                    "Value": "Memory Usage (bytes)"
                  }
                }
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "bytes"
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 20}
          }
        ],
        "time": {
          "from": "now-1h",
          "to": "now"
        },
        "refresh": "30s",
        "version": 1
      }
    }

  cost-monitoring.json: |
    {
      "dashboard": {
        "id": null,
        "title": "EKS Learning Lab - Cost Monitoring",
        "tags": ["kubernetes", "cost", "monitoring"],
        "style": "dark",
        "timezone": "browser",
        "panels": [
          {
            "id": 1,
            "title": "Estimated Hourly Cost",
            "type": "stat",
            "targets": [
              {
                "expr": "0.10 + (count(kube_node_info) * 0.0062)",
                "legendFormat": "Hourly Cost ($)"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "currencyUSD",
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 0.20},
                    {"color": "red", "value": 0.50}
                  ]
                }
              }
            },
            "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Daily Projected Cost",
            "type": "stat",
            "targets": [
              {
                "expr": "(0.10 + (count(kube_node_info) * 0.0062)) * 24",
                "legendFormat": "Daily Cost ($)"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "currencyUSD",
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 5},
                    {"color": "red", "value": 10}
                  ]
                }
              }
            },
            "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0}
          },
          {
            "id": 3,
            "title": "Resource Efficiency",
            "type": "graph",
            "targets": [
              {
                "expr": "avg(rate(container_cpu_usage_seconds_total[5m])) / avg(kube_pod_container_resource_requests{resource=\"cpu\"})",
                "legendFormat": "CPU Efficiency"
              },
              {
                "expr": "avg(container_memory_working_set_bytes) / avg(kube_pod_container_resource_requests{resource=\"memory\"})",
                "legendFormat": "Memory Efficiency"
              }
            ],
            "yAxes": [
              {
                "label": "Ratio",
                "max": 2,
                "min": 0
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4}
          },
          {
            "id": 4,
            "title": "Spot Instance Savings",
            "type": "stat",
            "targets": [
              {
                "expr": "count(kube_node_info{node=~\".*spot.*\"}) / count(kube_node_info) * 100",
                "legendFormat": "Spot Instances (%)"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 50},
                    {"color": "green", "value": 80}
                  ]
                }
              }
            },
            "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0}
          }
        ],
        "time": {
          "from": "now-6h",
          "to": "now"
        },
        "refresh": "1m",
        "version": 1
      }
    }

  learning-progress.json: |
    {
      "dashboard": {
        "id": null,
        "title": "EKS Learning Lab - Learning Progress",
        "tags": ["learning", "progress", "tools"],
        "style": "dark",
        "timezone": "browser",
        "panels": [
          {
            "id": 1,
            "title": "Installed Tools",
            "type": "table",
            "targets": [
              {
                "expr": "count by (namespace) (kube_deployment_status_replicas_available > 0)",
                "format": "table",
                "instant": true
              }
            ],
            "transformations": [
              {
                "id": "organize",
                "options": {
                  "excludeByName": {
                    "Time": true,
                    "__name__": true
                  },
                  "renameByName": {
                    "namespace": "Namespace",
                    "Value": "Running Deployments"
                  }
                }
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Service Mesh Status",
            "type": "stat",
            "targets": [
              {
                "expr": "count(kube_pod_info{namespace=\"istio-system\"})",
                "legendFormat": "Istio Pods"
              }
            ],
            "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0}
          },
          {
            "id": 3,
            "title": "GitOps Applications",
            "type": "stat",
            "targets": [
              {
                "expr": "count(kube_pod_info{namespace=\"argocd\"})",
                "legendFormat": "ArgoCD Pods"
              }
            ],
            "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0}
          },
          {
            "id": 4,
            "title": "Security Tools",
            "type": "graph",
            "targets": [
              {
                "expr": "count by (namespace) (kube_pod_info{namespace=~\"vault|gatekeeper-system|kyverno|falco\"})",
                "legendFormat": "{{namespace}}"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4}
          },
          {
            "id": 5,
            "title": "Learning Milestones",
            "type": "text",
            "content": "## EKS Learning Lab Progress\n\n### Core Infrastructure ✅\n- [x] EKS Cluster deployed\n- [x] Worker nodes running\n- [x] AWS Load Balancer Controller\n- [x] Cluster Autoscaler\n\n### GitOps & CI/CD\n- [x] ArgoCD deployed\n- [x] Tekton Pipelines\n- [x] Argo Workflows\n\n### Service Mesh\n- [x] Istio installation\n- [x] Linkerd setup\n- [ ] Traffic management\n- [ ] Security policies\n\n### Security\n- [x] Vault for secrets\n- [x] OPA Gatekeeper\n- [x] Kyverno policies\n- [x] Falco runtime security\n\n### Observability\n- [x] Prometheus monitoring\n- [x] Grafana dashboards\n- [x] Jaeger tracing\n- [x] ELK logging stack\n\n### Next Steps\n1. Explore service mesh features\n2. Set up monitoring alerts\n3. Practice GitOps workflows\n4. Learn security best practices",
            "gridPos": {"h": 12, "w": 24, "x": 0, "y": 12}
          }
        ],
        "time": {
          "from": "now-1h",
          "to": "now"
        },
        "refresh": "5m",
        "version": 1
      }
    }